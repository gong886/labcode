## 1 小组成员及学号

### 组长：龚子超-2312005
### 组员：熊泽宇-2312015，吴红祥-2312558

## 2 填写各个基本练习中要求完成的报告内容

### 2.1 练习一：分配并初始化一个进程控制块（需要编码）
alloc_proc函数（位于kern/process/proc.c中）负责分配并返回一个新的struct proc_struct结构，用于存储新建立的内核线程的管理信息。ucore需要对这个结构进行最基本的初始化，你需要完成这个初始化过程。

请在实验报告中简要说明你的设计实现过程。请回答如下问题：

请说明proc_struct中struct context context和struct trapframe *tf成员变量含义和在本实验中的作用是啥？（提示通过看代码和编程调试可以判断出来）

#### 2.1.1 设计实现过程

- 1.使用 `kmalloc` 为 `proc_struct` 分配内存。
- 2.字段初始化：`pgdir` 设置为 `boot_pgdir_pa`，表示进程的页目录表地址。`state` 设置为 `PROC_UNINIT`，表示进程初始状态为未初始化。`pid` 设置为 `-1`，表示进程 ID 尚未分配。`context` 和 `name` 使用 `memset` 清零，确保上下文和名称字段的初始值正确。
返回初始化后的 `proc_struct` 指针。


以下是实现的 `alloc_proc` 函数的核心代码：
```c
struct proc_struct *alloc_proc(void) {
    struct proc_struct *proc = kmalloc(sizeof(struct proc_struct));
    if (proc != NULL) {
        proc->pgdir = boot_pgdir_pa; // 页目录表地址
        proc->state = PROC_UNINIT; // 进程状态：未初始化
        proc->pid = -1; // 进程 ID
        proc->runs = 0;  // 运行次数
        proc->kstack = 0; // 内核栈地址
        proc->need_resched = 0; // 调度标志
        proc->flags = 0; // 进程标志
        proc->parent = NULL; // 父进程指针
        proc->mm = NULL; // 内存管理结构
        proc->tf = NULL; // 中断帧指针
        memset(&(proc->context), 0, sizeof(struct context)); // 清空上下文
        memset(proc->name, 0, PROC_NAME_LEN + 1);    // 清空进程名称        
    }
    return proc;
}
```

#### 2.1.2 `proc_struct` 中的关键字段含义及作用
-`struct context context`:
  - 含义：保存进程的上下文信息，包括寄存器值等，用于进程切换时保存和恢复 CPU 的状态。
  - 作用：在进程切换时，当前进程的上下文会被保存到 `context` 中，切换到其他进程时会从其 `context` 中恢复上下文。
  - 实验中的作用：在 `proc_run` 函数中，通过调用 `switch_to` 函数切换进程时，`context` 用于保存和恢复进程的运行状态。

- `struct trapframe *tf`：
  - 含义：保存进程在发生中断或异常时的寄存器状态。
  - 作用：在中断或异常发生时，`trapframe` 用于保存当前进程的寄存器状态，以便中断处理完成后恢复。
  - 实验中的作用：在 `do_fork` 函数中，`tf` 被复制到子进程，用于初始化子进程的中断上下文。




## 3 扩展练习 Challenge





